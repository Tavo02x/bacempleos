"use strict";(function(){angular.module("BacApp.controllers.puestos",["ui.bootstrap"]).controller("puestosController",function(n,t,i,r){n.model={};n.model.IdPuesto=0;n.model.Titulo="";n.model.Descripcion="";n.model.ImagenURL="";n.model.IdArea="";n.model.IdNivelAcademico=0;n.model.FechaCierreOferta="";n.model.IdJornada=0;n.model.Publicado=0;n.model.IdIdioma=0;n.model.IdPais=0;n.model.IdZona1=0;n.idiomaLabel="";n.areaLabel="";n.paisLabel="";n.Idiomas={};n.Paises={};n.JornadaLaboral={};n.GradoAcademico={};n.Areas={};n.show1=!1;n.show2=!1;n.show3=!1;n.show4=!1;n.show5=!1;n.show6=!1;n.show7=!1;n.show8=!1;n.StepOne=!0;n.StepTwo=!1;n.StepThree=!1;n.StepFour=!1;$("#txtFechaCierre").on("change",function(){console.log($(this).val())});n.getGradoAcademico=function(){u({},ApiService.GradoAcademicoGet,function(t){n.GradoAcademico=t.Lista})};n.getPaises=function(){var t=Utils.decodeJWT(),i={id:{value:t.UserId}};u(i,ApiService.GetPais,function(t){n.Paises=t.Lista})};n.getIdiomas=function(){u({},ApiService.getIdioma,function(t){n.Idiomas=t.Lista})};n.getJornadaLaboral=function(){u({},ApiService.JornadaLaboralGet,function(t){n.JornadaLaboral=t.Lista})};n.AreaLaboralGet=function(){u({},ApiService.AreaLaboralGet,function(t){n.Areas=t.Lista})};n.GetLabelFromGrado=function(n,t){var i,r;if(t)for(i=0;i<t.length;i++)if(r=t[i].IdNivelAcademico,r===n)return t[i].Descripcion};n.GetLabelFromPais=function(n,t){var i,r;if(t)for(i=0;i<t.length;i++)if(r=t[i].IdPais,r===n)return t[i].Descripcion};n.GetLabelFromJornada=function(n,t){var i,r;if(t)for(i=0;i<t.length;i++)if(r=t[i].IdJornada,r===n)return t[i].Descripcion};n.getZona=function(){var t={id:{value:n.model.IdPais}};u(t,ApiService.Zona1Get,function(t){n.Zona1=t.Lista})};n.GetDate=function(n){var t=new Date(n);return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()};n.SavePuesto=function(){for(var i,h,c,l,u=Utils.getValRepetear("NivelIdioma",["IdIdioma","Porcentaje"]),e=[],o=[],s=[],t=0;t<u.length;t++)i={IdPuesto:0,IdIdioma:u[t].IdIdioma,Porcentaje:u[t].Porcentaje,Borrado:!1},e.push(i);i={IdPuesto:0,IdPais:n.model.IdPais,Borrado:!1};o.push(i);s.push({IdPuesto:0,IdJornada:n.model.IdJornada,Borrado:!1});h=Utils.getValCheck("areas","IdArea");n.model.IdArea=h[0].IdArea;c=Utils.getValRepetear("Puestorequisito",["Descripcion"]);l={PuestoInfo:{IdPuesto:n.model.IdPuesto,Titulo:n.model.Titulo,Descripcion:n.model.Descripcion,ImagenURL:"",IdArea:n.model.IdArea,IdNivelAcademico:n.model.IdNivelAcademico,FechaCierreOferta:n.model.FechaCierreOferta,Publicado:!0,IdZona1:n.model.IdZona1},Idiomas:e,TipoJornadas:s,Puestos_Paises_BAC:o,Postulantes:[],Ferias:[],Requisitos:c};f(l,ApiService.PuestosSave,function(n){n.Resultado?Utils.MessageBox("¡Puesto creado exitosamente!","¡Puesto creado exitosamente!","Y puedes promocionar el puesto para atraer nuevos talentos.","Content/Images/IconoPuestoCreado.png",function(){window.location=r.baseUrl+"Puesto/FiltrarPuestos";this.modal("hide");$("#popupLoading").modal("hide")}):Utils.MessageBox("Creación de puesto","Creación de puesto",n.Mensaje,"Content/Images/IconoErrorGeneral.png",function(){$("#popupLoading").modal("hide");this.modal("hide")})})};var u=function(n,t,r){var u=Utils.getFilterParameters(n);i.doGet(t,u).then(r)},f=function(n,t,r){var u={Objeto:n,Lista:[],Token:"",Id:n.PuestoInfo.IdPuesto};i.doPost(t,u).then(r)};n.RemoveElement=function(n){var t;switch(n){case 4:t=$("#NivelIdioma > div").map(function(){return this.id}).toArray();t.length>1&&$("#"+t[t.length-1]).remove();break;case 5:t=$("#Puestorequisito > div").map(function(){return this.id}).toArray();t.length>1&&$("#"+t[t.length-1]).remove()}};n.AgregarIdioma=function(){var i=Utils.getValRepetear("NivelIdioma",["IdIdioma","Porcentaje"]),t=n.searchDuplicates(i,"IdIdioma");console.log(t);t.length==0?(Utils.cloneSelect("pnlRepeatNivelIdioma","agregarIdioma"),n.RepeticionIdioma=!1):n.RepeticionIdioma=!0};n.AgregarRequisito=function(){var t=Utils.getValRepetear("Puestorequisito",["Descripcion"]);n.chkDuplicates(t,!0)?n.RepeticionRequisitos=!0:(Utils.cloneElement("pnlRepeatRequisitos","agregarRequisito"),n.RepeticionRequisitos=!1)};n.ValidateStepOne=function(){var t=!0,i,r;return n.model.Titulo==""?(n.show1=!0,t=!1):n.show1=!1,n.model.Descripcion==""?(n.show2=!0,t=!1):n.show2=!1,n.model.IdNivelAcademico==""||n.model.IdNivelAcademico==null?(n.show3=!0,t=!1):n.show3=!1,n.model.IdJornada==""||n.model.IdJornada==null?(n.show4=!0,t=!1):n.show4=!1,n.model.FechaCierreOferta==""?(n.show5=!0,t=!1):n.show5=!1,i=Utils.getValRepetear("NivelIdioma",["IdIdioma","Porcentaje"]),n.chkDuplicates(i,!0)?(n.RepeticionIdioma=!0,t=!1):(i.length<=0?(n.show6=!0,t=!1):n.show6=!1,n.RepeticionIdioma=!1),r=Utils.getValRepetear("Puestorequisito",["Descripcion"]),n.chkDuplicates(r,!0)?(n.RepeticionRequisitos=!0,t=!1):(r.length<=0?(n.show61=!0,t=!1):n.show61=!1,n.RepeticionRequisitos=!1),t&&n.LimpiarShowStep1(),t};n.LimpiarShowStep1=function(){n.show1=!1;n.show2=!1;n.show3=!1;n.show4=!1;n.show5=!1;n.show6=!1};n.ValidateStepTwo=function(){var t=!0,i=Utils.getValCheck("areas","IdArea");return i.length<=0?(n.show7=!0,t=!1):n.show7=!1,t&&(n.show7=!1),t};n.ValidateStepThree=function(){var t=!0,i=Utils.getValCheck("pais","IdPais");return i.length<=0&&(n.show8=!0,t=!1),t&&(n.show8=!1),t};n.ChangeStep=function(){var i=n.ValidateStepOne(),f,r,u,t;if(n.StepOne==!0&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!1&&i)n.StepOne=!1,n.StepTwo=!0,n.StepThree=!1,n.StepFour=!1,$("#divStepTwo").removeClass("Secundario").addClass("Primaria"),$("#circuloStepTwo").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepTwo").removeClass("textoSecundario").addClass("textoPrimario"),i=n.ValidateStepTwo();else if(n.StepOne==!1&&n.StepTwo==!0&&n.StepThree==!1&&n.StepFour==!1&&i)n.StepOne=!1,n.StepTwo=!1,n.StepThree=!0,n.StepFour=!1,$("#divStepThree").removeClass("Secundario").addClass("Primaria"),$("#circuloStepThree").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepThree").removeClass("textoSecundario").addClass("textoPrimario"),i=n.ValidateStepThree();else if(n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!0&&n.StepFour==!1&&i){for(n.StepOne=!1,n.StepTwo=!1,n.StepThree=!1,n.StepFour=!0,$("#divStepFour").removeClass("Secundario").addClass("Primaria"),$("#circuloStepFour").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepFour").removeClass("textoSecundario").addClass("textoPrimario"),f=Utils.getValCheck("areas","IdArea"),n.model.IdArea=f[0].IdArea,n.areaLabel=n.Areas.where(function(t){return t.IdArea==n.model.IdArea}).select(function(n){return n.Area}),r=Utils.getValRepetear("NivelIdioma",["IdIdioma","Porcentaje"]),t=0;t<r.length;t++)n.idiomaLabel+=n.Idiomas.where(function(n){return n.IdIdioma==r[t].IdIdioma}).select(function(n){return n.Descripcion})+",";for(u=Utils.getValCheck("pais","IdPais"),t=0;t<u.length;t++)n.paisLabel+=n.Paises.where(function(n){return n.IdPais==u[t].IdPais}).select(function(n){return n.Descripcion})+","}else n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!0&&n.SavePuesto();$("html, body").animate({scrollTop:0},600)};n.ReturnStep=function(){n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!0?(n.StepOne=!1,n.StepTwo=!1,n.StepThree=!0,n.StepFour=!1,$("#divStepFour").removeClass("Primaria").addClass("Secundario"),$("#divStepThree").removeClass("Secundario").addClass("Primaria"),$("#circuloStepFour").removeClass("CirculoPrimario").addClass("CirculoSecundario"),$("#circuloStepThree").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepFour").removeClass("textoPrimario").addClass("textoSecundario"),$("#textStepThree").removeClass("textoSecundario").addClass("textoPrimario")):n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!0&&n.StepFour==!1?(n.StepOne=!1,n.StepTwo=!0,n.StepThree=!1,n.StepFour=!1,$("#divStepThree").removeClass("Primaria").addClass("Secundario"),$("#divStepTwo").removeClass("Secundario").addClass("Primaria"),$("#circuloStepThree").removeClass("CirculoPrimario").addClass("CirculoSecundario"),$("#circuloStepTwo").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepThree").removeClass("textoPrimario").addClass("textoSecundario"),$("#textStepTwo").removeClass("textoSecundario").addClass("textoPrimario")):n.StepOne==!1&&n.StepTwo==!0&&n.StepThree==!1&&n.StepFour==!1?(n.StepOne=!0,n.StepTwo=!1,n.StepThree=!1,n.StepFour=!1,$("#divStepTwo").removeClass("Primaria").addClass("Secundario"),$("#divStepOne").removeClass("Secundario").addClass("Primaria"),$("#circuloStepTwo").removeClass("CirculoPrimario").addClass("CirculoSecundario"),$("#circuloStepOne").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepTwo").removeClass("textoPrimario").addClass("textoSecundario"),$("#textStepOne").removeClass("textoSecundario").addClass("textoPrimario")):n.StepOne==!0&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!1&&(window.location=r.baseUrl+"Puesto/FiltrarPuestos");$("html, body").animate({scrollTop:0},600)};n.Volver=function(){window.location=r.baseUrl+"Puesto/FiltrarPuestos"};n.SeguridadJS=function(){var n=JSON.parse(sessionStorage.getItem("role")),t;n!=null&&(t=n.where(function(n){return n.TipoAccionId==3&&n.ReferenciasAux=="puestosController"}),$.each(t,function(n,t){var i=eval("$scope."+t.ReferenciaJS);i!=undefined&&i!=null&&i!=""&&eval("$scope."+t.ReferenciaJS+"= function () { }")}))};n.searchDuplicates=function(n,t){var r={};for(var i in n)r[n[i][t]]=n[i]};n.chkDuplicates=function(n,t){var u=n.length,f={},e=n.slice(),r=[],i;for(e.sort();u--;){if(i=e[u],/nul|nan|infini/i.test(String(i))&&(i=String(i)),f[JSON.stringify(i)]){if(t)return!0;r.push(i)}f[JSON.stringify(i)]=!0}return t?!1:r.length?r:null};n.dateOptions={showWeeks:!1,formatYear:"yy",minDate:new Date,startingDay:0,placement:"bottom"};n.openDatepicker=function(){n.datepicker.opened=!0};n.format="dd/MM/yyyy";n.datepicker={opened:!1}})})();