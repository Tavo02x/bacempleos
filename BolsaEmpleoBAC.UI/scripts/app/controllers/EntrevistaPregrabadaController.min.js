"use strict";(function(){angular.module("BacApp.controllers.entrevistaPregrabada",["jkAngularRatingStars"]).controller("EntrevistaPregrabadaController",function(n,t,i,r){n.IdPostulante=Utils.getUrlParameter("IdPostulante");n.Email=Utils.getUrlParameter("User");n.Fecha=new Date;n.PreguntaBuscar="";n.IdArea=0;n.IdPuesto=0;n.Puestos={};n.Preguntas={};n.Areas={};n.AgregarPreguntas=!0;n.PreguntasUsadas=!1;n.PanelPreguntas=!1;n.botonesAgregar=!1;n.StepOne=!0;n.StepTwo=!1;n.ChangeStep=function(){n.StepOne==!0&&n.StepTwo==!1?n.IdPuesto!=""&&n.IdPuesto!=0&&n.IdPuesto!=null?(n.StepOne=!1,n.StepTwo=!0,$("#divStepTwo").removeClass("Secundario").addClass("Primaria"),$("#circuloStepTwo").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepTwo").removeClass("textoSecundario").addClass("textoPrimario")):Utils.MessageBox("Entrevista Pregrabada","Entrevista Pregrabada","Debe seleccionar un puesto.","Content/Images/IconoErrorGeneral.png",function(){return this.hide(),!1}):n.StepOne==!1&&n.StepTwo==!0&&n.GuardarEntrevista()};n.AgregarOtraPregunta=function(){Utils.cloneElement("pnlRepetearPreguntas","agregarPreguntas")};n.AgregarPreguntadaUsada=function(){n.AgregarPreguntas=!1;n.PreguntasUsadas=!0};n.ReturnAgregarPreguntas=function(){n.AgregarPreguntas=!0;n.PreguntasUsadas=!1;$("#divListaPreguntas").empty();n.IdArea="";n.PanelPreguntas=!1;n.botonesAgregar=!1;n.PreguntaBuscar=""};n.AgregarPregunta=function(){var t=$("#divPreguntas > div").map(function(){return this.id}).toArray();$.each($(".cuadroSeleccionado"),function(n,i){var r=$("#"+i.id+" > span").text();$("#"+t[t.length-1]+" > div > div > input").val(r)});n.ReturnAgregarPreguntas()};n.AreaLaboralGet=function(){u({},ApiService.AreaLaboralGet,function(t){n.Areas=t.Lista})};n.getPreguntas=function(){if(n.IdArea!=""&&n.IdArea!=0&&n.IdArea!=null){var t={Descripcion:{value:n.PreguntaBuscar},IdArea:{value:n.IdArea}};u(t,ApiService.GetPreguntasByArea,function(t){if(n.Preguntas=t.Lista,n.PanelPreguntas=!0,t.Lista.length>0){$("#divListaPreguntas").empty();var i="";$.each(n.Preguntas,function(r,u){i="";i+='<a id="a'+u.IdPregunta+'"><div id="div'+u.IdPregunta+'" data-id="'+u.IdPregunta+'" class="cuadro cuadroSeparador">';i+='   <span class="LetrasContenido">'+u.Descripcion+"<\/span>";i+="<\/div ><\/a>";$("#divListaPreguntas").append(i);$("#lblCount").text(t.Lista.length);n.botonesAgregar=!0;$("#a"+u.IdPregunta).on("click",function(){$(".cuadroSeleccionado").removeClass("cuadroSeleccionado");$("#div"+u.IdPregunta).addClass("cuadroSeleccionado")})})}else $("#divListaPreguntas").empty(),$("#lblCount").text(0),n.botonesAgregar=!1})}else Utils.MessageBox("Entrevista Pregrabada","Entrevista Pregrabada","Debe seleccionar un área.","Content/Images/IconoErrorGeneral.png",function(){return this.hide(),!1})};n.getPuestos=function(){var t={IdPostulante:{value:n.IdPostulante}};u(t,ApiService.PuestosByPostulanteGet,function(t){n.Puestos=t.Lista})};n.RemovePregunta=function(){var n=$("#divPreguntas > div").map(function(){return this.id}).toArray();n.length>1&&$("#"+n[n.length-1]).remove()};n.GuardarEntrevista=function(){for(var e,o,s,u=[],i=n.getValRepetear("divPreguntas",["Descripcion","Tiempo"]),t=0;t<i.length;t++)e={IdPregunta:0,Descripcion:i[t].Descripcion,Tiempo:i[t].Tiempo,IdArea:n.IdArea==null?0:n.IdArea},u.push(e);o=Utils.decodeJWT().UserId;s={IdPostulante:n.IdPostulante,IdEntrevista:0,IdUsuario:o,IdPuesto:n.IdPuesto,FechaEntrevista:n.Fecha,preguntas:u};f(s,ApiService.SaveEntrevista,function(t){t.Resultado?Utils.MessageBox("Entrevista Pregrabada","Entrevista Pregrabada","Entrevista guardada con éxito","Content/Images/IconoEntrevistaAgendada.png",function(){return window.location=r.baseUrl+"Postulante/VerPerfil?IdPostulante="+n.Email,!1}):Utils.MessageBox("Entrevista Pregrabada","Entrevista Pregrabada",t.Mensaje,"Content/Images/IconoErrorGeneral.png",function(){return this.modal("hide"),$("#popupLoading").modal("hide"),!1})})};n.Return=function(){window.location=r.baseUrl+"Postulante/VerPerfil?IdPostulante="+n.Email};n.getValRepetear=function(n,t){var i=[],r=$("#"+n+" > div").map(function(){return this.id}).toArray();return r.forEach(function(n){var f=$("#"+n+" > div > div >").map(function(){return this.value}).toArray(),r="{",u;f.forEach(function(n,i){n!=""&&n!=undefined&&n!=0&&(r+='"'+t[i]+'":"'+n+'",')});r=r.substring(0,r.length-1)+"}";r!="{}"&&(u=JSON.parse(r),i.push(u))}),i};var u=function(n,t,r){var u=Utils.getFilterParameters(n);i.doGet(t,u).then(r)},f=function(n,t,r){var u={Objeto:n,Lista:[],Token:"",Id:0};i.doPost(t,u).then(r)};n.SeguridadJS=function(){var n=JSON.parse(sessionStorage.getItem("role")),t;n!=null&&(t=n.where(function(n){return n.TipoAccionId==3&&n.ReferenciasAux=="EntrevistaPregrabadaController"}),$.each(t,function(n,t){var i=eval("$scope."+t.ReferenciaJS);i!=undefined&&i!=null&&i!=""&&eval("$scope."+t.ReferenciaJS+"= function () { }")}))};n.dateOptions={showWeeks:!1,formatYear:"yy",minDate:new Date,startingDay:0,placement:"bottom"};n.openDatepicker=function(){n.datepicker.opened=!0};n.format="dd/MM/yyyy";n.datepicker={opened:!1}})})();