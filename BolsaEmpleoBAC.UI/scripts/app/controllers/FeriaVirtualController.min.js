"use strict";(function(){angular.module("BacApp.controllers.feriavirtual",[]).controller("FeriaVirtualController",function(n,t,i,r){var f=new Date,u,e;n.model={};n.model.nombre="";n.model.fechainicio="";n.model.fechacierre="";n.model.horainicio="";n.model.horafinal="";n.model.frecuencia="";n.dateNow=f.getDate()+"/"+(f.getMonth()+1)+"/"+f.getFullYear();n.PaisId=0;n.Puesto="";n.Entrevistador="";n.paisName="";n.index=0;n.index2=0;n.StepOne=!0;n.StepTwo=!1;n.StepThree=!1;n.StepFour=!1;n.addPuesto=!1;n.addEntrevistador=!1;n.IsAdd=!1;n.IsNext=!0;n.Paises={};n.PaisesPuestos={};n.PaisesEntrevistadores={};n.Puestos={};n.PuestosPaises={};n.Reclutadores={};n.ReclutadoresPaises={};n.PuestosPaises=[];n.ReclutadoresPaises=[];n.FrecuenciaInvalido=!1;n.FeriaInvalido=!1;n.FechaInicioInvalido=!1;n.FechaCierreInvalido=!1;n.HoraInicioInvalido=!1;n.HoraFinalInvalido=!1;n.PaisInvalido=!1;n.EntrevistadorInvalido=!1;n.PuestoInvalido=!1;n.getPaisesBAC=function(){var t=Utils.decodeJWT(),i={id:{value:t.UserId}};u(i,ApiService.GetPais,function(t){n.Paises=t.Lista})};n.getPuestos=function(){var t={IdPais:{value:n.PaisId}};u(t,ApiService.PuestosByPaisGet,function(t){n.Puestos=t.Lista})};n.getEntrevistadores=function(){var t={IdPais:{value:n.PaisId}};u(t,ApiService.EntrevistadorByPaisGet,function(t){n.Reclutadores=t.Lista})};n.getPuestosbyNombre=function(){if(n.Puesto=="")n.getPuestos();else{var t={Nombre:{value:n.Puesto},IdPais:{value:n.PaisId}};u(t,ApiService.PuestosByNombreGet,function(t){n.Puestos=t.Lista})}};n.getEntrevistadoresbyNombre=function(){if(n.Entrevistador=="")n.getEntrevistadores();else{var t={Nombre:{value:n.Entrevistador},IdPais:{value:n.PaisId}};u(t,ApiService.EntrevistadorByNombreGet,function(t){n.Reclutadores=t.Lista})}};n.ValidarStepOne=function(){var t=!0;n.model.nombre==""?(n.FeriaInvalido=!0,t=!1):n.FeriaInvalido=!1;n.model.frecuencia==""||n.model.frecuencia==undefined?(n.FrecuenciaInvalido=!0,t=!1):n.FrecuenciaInvalido=!1;n.model.fechainicio==""?(n.FechaInicioInvalido=!0,t=!1):n.FechaInicioInvalido=!1;n.model.fechacierre==""?(n.FechaCierreInvalido=!0,t=!1):n.FechaCierreInvalido=!1;n.model.fechainicio>n.model.fechacierre?(n.FechaValidacionInvalido=!0,t=!1):n.FechaValidacionInvalido=!1;n.model.horainicio==""||n.model.horainicio==undefined?(n.HoraInicioInvalido=!0,t=!1):n.HoraInicioInvalido=!1;n.model.horafinal==""||n.model.horafinal==undefined?(n.HoraFinalInvalido=!0,t=!1):n.HoraFinalInvalido=!1;var i=n.model.horainicio.split(":"),r=n.model.horafinal.split(":"),u=+i[0],f=+r[0];return u>f?(n.HoraValidacionInvalido=!0,t=!1):n.HoraValidacionInvalido=!1,t};n.ValidarStepTwo=function(){var i=Utils.getValCheck("pais","IdPais"),t=!0;return i.length==0?(n.PaisInvalido=!0,t=!1):n.PaisInvalido=!1,t};n.ValidarStepThree=function(){var i=Utils.getValCheck("reclutadores","IdReclutador"),t=!0;return i.length==0?(n.EntrevistadorInvalido=!0,t=!1):n.EntrevistadorInvalido=!1,t};n.ValidarStepFour=function(){var i=Utils.getValCheck("puestos","IdPuesto"),t=!0;return i.length==0?(n.PuestoInvalido=!0,t=!1):n.PuestoInvalido=!1,t};n.saveFeriaVirtual=function(){for(var f,o,i=[],u=Utils.getValCheck("pais","IdPais"),t=0;t<u.length;t++)f={IdPais:u[t].IdPais,Borrado:!1},i.push(f);o={Descripcion:n.model.nombre,Borrado:!1,Titulo:n.model.nombre,FechaInicio:n.model.fechainicio,FechaFinal:n.model.fechacierre,FrecuenciaHora:n.model.frecuencia,HoraInicio:n.model.horainicio,HoraFinal:n.model.horafinal,FeriaEmpleo_Entrevistadores:n.ReclutadoresPaises,FeriaEmpleo_Puestos:n.PuestosPaises,Paises_Bac_FeriaEmpleo:i};e(o,ApiService.FeriavirtualSave,function(n){n.Resultado?Utils.MessageBox("¡Feria virtual creada exitosamente!","¡Feria virtual creada exitosamente!","Ya puedes promover la feria virtual para atraer nuevos talentos a nuestra empresa.","Content/Images/IconoFeriaVirtualCreada.png",function(){return window.location=r.baseUrl+"FeriaVirtual/VerFeriaVirtual",!1}):Utils.MessageBox("Creación de feria virtual","Creación de feria virtual",n.Mensaje,"Content/Images/IconoErrorGeneral.png",function(){return!1})})};n.ChangeStep=function(){n.StepOne==!0&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!1?n.ValidarStepOne()&&(n.StepOne=!1,n.StepTwo=!0,n.StepThree=!1,n.StepFour=!1,$("#divStepTwo").removeClass("Secundario").addClass("Primaria"),$("#circuloStepTwo").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepTwo").removeClass("textoSecundario").addClass("textoPrimario")):n.StepOne==!1&&n.StepTwo==!0&&n.StepThree==!1&&n.StepFour==!1&&n.addEntrevistador==!1&&n.addPuesto==!1||n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!0&&n.StepFour==!1&&n.addEntrevistador==!1&&n.addPuesto==!1?n.ValidarStepTwo()&&(n.StepOne=!1,n.StepTwo=!1,n.StepThree=!0,n.StepFour=!1,$("#divStepThree").removeClass("Secundario").addClass("Primaria"),$("#circuloStepThree").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepThree").removeClass("textoSecundario").addClass("textoPrimario"),n.PaisesEntrevistadores=Utils.getValCheck("pais","IdPais"),n.PaisId=n.PaisesEntrevistadores.length==1?n.PaisesEntrevistadores[0].IdPais:n.PaisesEntrevistadores[n.index].IdPais,n.paisName=n.Paises.where(function(t){return t.IdPais==n.PaisId}).select(function(n){return n.Descripcion}).first(),n.PaisesEntrevistadores.length==1?n.PaisesEntrevistadores.length<n.index+1&&(n.addEntrevistador=!0):n.PaisesEntrevistadores.length<=n.index+1&&(n.addEntrevistador=!0),n.index=n.index+1,n.IsNext=!1,n.IsAdd=!0,n.getEntrevistadores()):n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!0&&n.StepFour==!1&&n.addEntrevistador==!0&&n.addPuesto==!1||n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!0&&n.addEntrevistador==!0&&n.addPuesto==!1?n.ValidarStepThree()&&(n.StepOne=!1,n.StepTwo=!1,n.StepThree=!1,n.StepFour=!0,$("#divStepFour").removeClass("Secundario").addClass("Primaria"),$("#circuloStepFour").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepFour").removeClass("textoSecundario").addClass("textoPrimario"),n.PaisesEntrevistadores=Utils.getValCheck("pais","IdPais"),n.PaisId=n.PaisesEntrevistadores.length==1?n.PaisesEntrevistadores[0].IdPais:n.PaisesEntrevistadores[n.index2].IdPais,n.paisName=n.Paises.where(function(t){return t.IdPais==n.PaisId}).select(function(n){return n.Descripcion}).first(),n.PaisesEntrevistadores.length==1?n.PaisesEntrevistadores.length<n.index2+1&&(n.addPuesto=!0,$("#btnContinuar").val("Crear feria")):n.PaisesEntrevistadores.length<=n.index2+1&&(n.addPuesto=!0,$("#btnContinuar").val("Crear feria")),n.index2=n.index2+1,n.IsNext=!1,n.IsAdd=!0,n.getPuestos()):n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!0&&n.addPuesto==!0&&n.addEntrevistador==!0&&n.ValidarStepFour()&&n.saveFeriaVirtual()};n.ReturnStep=function(){window.location.reload(!0)};n.Agregar=function(){var r,u,t,i;if(n.addEntrevistador==!1){for(r=Utils.getValCheck("reclutadores","IdUsuario"),t=0;t<r.length;t++)i={IdPais:n.PaisId,IdUsuario:r[t].IdUsuario,Borrado:!1},n.ReclutadoresPaises.push(i),n.PaisesEntrevistadores.length==1&&(n.addEntrevistador=!0);console.log(n.ReclutadoresPaises)}if(n.addPuesto==!1){for(u=Utils.getValCheck("puestos","IdPuesto"),t=0;t<u.length;t++)i={IdPais:n.PaisId,IdPuesto:u[t].IdPuesto,Borrado:!1},n.PuestosPaises.push(i),n.PaisesEntrevistadores.length==1&&(n.addPuesto=!0);console.log(n.PuestosPaises)}n.IsAdd=!1;n.IsNext=!0};n.ReturnLobby=function(){window.location=r.baseUrl+"FeriaVirtual/VerFeriaVirtual"};u=function(n,t,r){var u=Utils.getFilterParameters(n);i.doGet(t,u).then(r)};e=function(n,t,r){var u={Objeto:n,Lista:[],Token:"",Id:0};i.doPost(t,u).then(r)};n.GenerarArrayHoras=function(){for(var r="10:00",u=30,f="08:00".split(":"),e=r.split(":"),o=[],i="",t=+f[0],n=+f[1],s;i!=r;)i=(t<10?"0"+t:t)+":"+(n<10?"0"+n:n),o.push(i),n=+n+ +u,(+u>30?+n>=60:+n%60==0)&&(t=+t+1,n=+u>30?n%60:0),+e[0]==t&&+n>+e[1]&&(i=r);s=o.join()};n.SeguridadJS=function(){var n=JSON.parse(sessionStorage.getItem("role")),t;n!=null&&(t=n.where(function(n){return n.TipoAccionId==3&&n.ReferenciasAux=="FeriaVirtualController"}),$.each(t,function(n,t){var i=eval("$scope."+t.ReferenciaJS);i!=undefined&&i!=null&&i!=""&&eval("$scope."+t.ReferenciaJS+"= function () { }")}))};n.dateOptions={showWeeks:!1,formatYear:"yy",minDate:new Date,startingDay:0,placement:"bottom"};n.format="dd/MM/yyyy";n.openDateStart=function(){n.dateStart.opened=!0};n.dateStart={opened:!1};n.openDateEnd=function(){n.dateEnd.opened=!0};n.dateEnd={opened:!1}})})();