"use strict";(function(){angular.module("BacApp.controllers.Usuarios",[]).controller("UsuariosController",function(n,t,i,r){n.model={};n.model.Info={};n.model.Info.IdUsuario=0;n.model.Info.NombreCompleto="";n.model.Info.Usuario1="";n.model.Info.Email="";n.model.Info.Password="";n.model.Info.Borrado=!1;n.model.Info.IdPais=1;n.model.Info.IdTipoLogin=1;n.model.Info.FechaCreacion=new Date;n.model.Paises=[];n.model.Roles=[];n.show1=!1;n.show2=!1;n.show3=!1;n.EmailInvalido=!1;n.EmailExiste=!1;var u=function(n,t,r){var u=Utils.getFilterParameters(n);i.doGet(t,u).then(r)},f=function(n,t,r){var u={Objeto:n,Lista:[],Token:"",Id:0};i.doPost(t,u).then(r)};n.getPaises=function(){var t=Utils.decodeJWT(),i={id:{value:t.UserId}};u(i,ApiService.GetPais,function(t){n.Paises=t.Lista})};n.getRoles=function(){u({},ApiService.RolGet,function(t){var r=JSON.parse(sessionStorage.getItem("role")),i=r.where(function(n){return n.AccionId==98});n.Roles=i.length==0?t.Lista.where(function(n){return!n.Borrado}):t.Lista.where(function(n){return!n.Borrado&&n.IdRol!=+i[0].ReferenciasAux})})};n.validateEmail=function(){var t={email:{value:n.model.PostulanteInfo.Email}};u(t,ApiService.ValidateEmail,function(t){n.EmailExiste=t.Objeto})};n.Validate=function(){var t=!0,i,r;return n.model.Info.Email==""?(n.EmailInvalido=!0,t=!1):n.EmailInvalido=!1,n.model.Info.NombreCompleto==""?(n.show1=!0,t=!1):n.show1=!1,i=Utils.getValCheck("pais","IdPais"),i.length==0?(n.show2=!0,t=!1):n.show2=!1,r=Utils.getValCheck("rol","IdRol"),r.length==0?(n.show3=!0,t=!1):n.show3=!1,n.model.Info.Password==""&&n.model.Info.IdUsuario==0?(n.show4=!0,t=!1):n.show4=!1,t};n.getInfo=function(){var t=Utils.getUrlParameter("IdUsuario"),i;t!=0&&(i={id:{value:t}},u(i,ApiService.UsuarioGet,function(t){var i=t.Objeto;n.model.Info.IdUsuario=i.Info.IdUsuario;n.model.Info.NombreCompleto=i.Info.NombreCompleto;n.model.Info.Usuario1=i.Info.Usuario1;n.model.Info.Email=i.Info.Email;n.model.Info.Borrado=i.Info.Borrado;$("input[name=rol]").each(function(){var t=$(this).val(),n=i.Roles.any(function(n){return n.IdRol==t});$(this).prop("checked",n);$(this).prop("value",n)});$("input[name=pais]").each(function(){var t=$(this).val(),n=i.Paises.any(function(n){return n.IdPais==t});$(this).prop("checked",n);$(this).prop("value",n)})}))};n.Guardar=function(){if(n.Validate()){n.model.Paises=Utils.getValCheckEdit("pais","IdPais");n.model.Roles=Utils.getValCheckEdit("rol","IdRol");n.model.Info.Usuario1=n.model.Info.Email;n.model.Info.Password!=""&&(n.model.Info.Password=md5(n.model.Info.Password));var t="",i="",u="";n.model.Info.IdUsuario==0?(t="Agregaste con éxito al nuevo usuario",i="El nuevo usuario ya puede hacer uso de la plataforma de empleos.",u="Content/Images/IconoActualizacionUsuario.png"):(t="Actualizaste con éxito los datos del usuario",i="Muchas gracias, se actualizaron los datos en nuestra base de datos.",u="Content/Images/IconoActualizacionUsuario.png");f(n.model,ApiService.UsuarioSave,function(n){n.Resultado?Utils.MessageBox(t,t,i,u,function(){this.modal("hide");$("popupLoading").modal("hide");window.location=r.baseUrl+"Usuario/VerUsuarios"}):Utils.MessageBox("Mantenimiento de Usuarios","Mantenimiento de Usuarios",n.Mensaje,"Content/Images/IconoErrorGeneral.png",function(){return this.modal("hide"),$("popupLoading").modal("hide"),!1})})}};n.Cancelar=function(){window.location=r.baseUrl+"Usuario/VerUsuarios"};n.validateEmail=function(){var t={email:{value:n.model.PostulanteInfo.Email}};u(t,ApiService.ValidateEmail,function(t){n.EmailExiste=t.Objeto})};n.Volver=function(){window.location=r.baseUrl+"Usuario/VerUsuarios"};n.SeguridadJS=function(){var n=JSON.parse(sessionStorage.getItem("role")),t;n!=null&&(t=n.where(function(n){return n.TipoAccionId==3&&n.ReferenciasAux=="UsuariosController"}),$.each(t,function(n,t){var i=eval("$scope."+t.ReferenciaJS);i!=undefined&&i!=null&&i!=""&&eval("$scope."+t.ReferenciaJS+"= function () { }")}))}})})();