"use strict";(function(){angular.module("BacApp.controllers.Rol",[]).controller("RolController",function(n,t,i,r){n.model={};n.model.IdRol=0;n.model.Descripcion="";n.model.Borrado=!1;n.model.IsMultipais=!1;n.model.FechaCreacion=new Date;n.model.Acciones=[];n.show1=!1;n.show2=!1;var u=function(n,t,r){var u=Utils.getFilterParameters(n);i.doGet(t,u).then(r)},f=function(t,r,u){var f={Objeto:t,Lista:[],Token:"",Id:n.model.IdRol};i.doPost(r,f).then(u)};n.CargarRol=function(){var t=Utils.getUrlParameter("IdRol"),i;console.log(t);t!=0&&(i={id:{value:t}},u(i,ApiService.RolGetRolAccion,function(t){console.log(t);var i=t.Objeto;n.model.IdRol=i.IdRol;n.model.Descripcion=i.Descripcion;n.model.Borrado=i.Borrado;n.model.FechaCreacion=i.FechaCreacion;n.model.Acciones=i.Rol_Acciones;$.each(n.model.Acciones,function(n,t){$("#div"+t.AccionId).addClass("cuadroSeleccionado")})}))};n.getAccion=function(){u({},ApiService.AccionGet,function(t){n.acciones=t.Lista;console.log(t);var i="";$.each(n.acciones,function(n,t){i="";i+='<a id="a'+t.AccionId+'"><div id="div'+t.AccionId+'" data-id="'+t.AccionId+'" class="cuadro cuadroSeparador">';i+='   <span class="LetrasContenido textoNegrita">'+t.Nombre+"<\/span><br />";i+='   <span class="LetrasContenido">'+t.Descripcion+"<\/span>";i+="<\/div ><\/a>";$("#divAccion").append(i);$("#a"+t.AccionId).on("click",function(){$("#div"+t.AccionId).hasClass("cuadroSeleccionado")?$("#div"+t.AccionId).removeClass("cuadroSeleccionado"):$("#div"+t.AccionId).addClass("cuadroSeleccionado")})});n.CargarRol()})};n.Validate=function(){var t,i;return n.show1=!1,n.show2=!1,t=!0,n.model.Descripcion==""&&(n.show1=!0,t=!1),i=$(".cuadroSeleccionado"),i.length==0&&(n.show2=!0,t=!1),t};n.Guardar=function(){if(n.Validate()){n.model.Acciones=[];$.each($(".cuadroSeleccionado"),function(t,i){var r=$("#"+i.id).attr("data-id"),u=n.acciones.where(function(n){return n.AccionId==+r});n.model.Acciones.push(u[0].AccionId)});var t={IdRol:n.model.IdRol,Descripcion:n.model.Descripcion,Acciones:n.model.Acciones.join(),Borrado:n.model.Borrado,IsMultipais:n.model.IsMultipais};f(t,ApiService.RolSave,function(t){t.Resultado?Utils.MessageBox("Mantenimiento de Roles","Roles",t.Mensaje,"Content/Images/IconoConfimacion1.png",function(){window.location=r.baseUrl+"Rol/Index";this.modal("hide");$("#popupLoading").modal("hide")}):Utils.MessageBox("Mantenimiento de Roles","Roles",t.Mensaje,"Content/Images/IconoErrorGeneral.png",function(){n.Cancelar();this.modal("hide");$("#popupLoading").modal("hide")})})}};n.Cancelar=function(){n.model.IdRol=0;n.model.Descripcion="";n.model.Borrado=!1;n.model.IsMultipais=!1;n.model.FechaCreacion=Date.now;n.model.Acciones=[];$.each($(".cuadroSeleccionado"),function(n,t){$("#"+t.id).removeClass("cuadroSeleccionado")})};n.SeguridadJS=function(){var n=JSON.parse(sessionStorage.getItem("role")),t;n!=null&&(t=n.where(function(n){return n.TipoAccionId==3&&n.ReferenciasAux=="RolController"}),$.each(t,function(n,t){var i=eval("$scope."+t.ReferenciaJS);i!=undefined&&i!=null&&i!=""&&eval("$scope."+t.ReferenciaJS+"= function () { }")}))}})})();