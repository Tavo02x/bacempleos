"use strict";(function(){angular.module("BacApp.controllers.EntrevistaEnVivoFeria",[]).controller("EntrevistaEnVivoFeriaController",function(n,t,i,r){var u,f;n.model={};n.IdPostulante=0;n.IdFeriaEmpleo=Utils.getUrlParameter("IdFeriaEmpleo");n.IdPuesto=Utils.getUrlParameter("IdPuesto");n.IdEntrevista=Utils.getUrlParameter("IdEntrevista");n.Date=new Date;n.Hour="";n.HoraInicial=new Date;n.HoraFinal=new Date;n.DateInterview=new Date;n.FechaInicial=new Date;n.FechaFinal=new Date;n.FechaMax="";n.FechaMin="";n.Frecuencia=0;n.Horas={};n.GetDetalleFeriaVirtual=function(){console.log(n.IdEntrevista);n.IdEntrevista==""&&(n.IdEntrevista=0);var t={IdFeriaEmpleo:{value:n.IdFeriaEmpleo}};u(t,ApiService.GetFeriaDetalles,function(t){var i=t.Objeto;n.HoraInicial=i.HoraInicial;n.HoraFinal=i.HoraFinal;n.FechaInicial=new Date(i.FechaInicio);n.FechaFinal=new Date(i.FechaFin);n.FechaMax=i.FechaMax;n.FechaMin=i.FechaMin;n.Frecuencia=i.Frecuencia;n.Horas=n.GenerarArrayHoras(i.Frecuencia,i.HoraInicio,i.HoraFinal);n.IdEntrevista!=0&&n.GetDetalleEntrevista()})};n.GetDetalleEntrevista=function(){var t={IdEntrevista:{value:n.IdEntrevista}};u(t,ApiService.GetEntrevistaById,function(t){var i=t;n.Hour=i.Hora;n.Date=new Date(i.FechaEntrevista)})};n.AceptarEntrevista=function(){var t={IdEntrevista:{value:n.IdEntrevista}};$("#popupLoading").modal("show");u(t,ApiService.AceptarEntrevista,function(){Utils.MessageBox("Aceptar entrevista","Aceptar entrevista","Entrevista aceptada exitosamente","Content/Images/IconoConfimacion1.png",function(){return this.modal("hide"),$("#popupLoading").modal("hide"),window.location=r.baseUrl+"FeriaVirtual/DetalleFeriaVirtual?IdFeriaEmpleo="+n.IdFeriaEmpleo,!1})})};n.AgendarEntrevista=function(){var t=Utils.decodeJWT(),i={topic:"Entrevista en vivo",Start_time:new Date(n.Date),Hour:n.Hour,IdPostulante:n.IdPostulante,IdSolicitante:t.UserId,IdPuesto:n.IdPuesto,IdEntrevista:n.IdEntrevista,IdFeriaEmpleo:n.IdFeriaEmpleo,Auto_recording:"cloud",Duration:15};f(i,ApiService.AgendarEntrevistaFeria,function(t){t.Resultado?Utils.MessageBox("Entrevista","Entrevista",'Entrevista agendada exitosamente<br/> <a href="'+t.Objeto.JoinUrl+'" target="_blank">Url de ingreso<\/a><br/><a href="'+t.Objeto.StartUrl+'" target="_blank">Url de ingreso inmediato<\/a>',"Content/Images/IconoConfirmacionFeriaVirtual.png",function(){return this.modal("hide"),window.location=r.baseUrl+"Puesto/VerPuestoFeria?IdPuesto="+n.IdPuesto+"&IdFeriaEmpleo="+n.IdFeriaEmpleo,!1}):Utils.MessageBox("Entrevista","Entrevista",t.Mensaje,"Content/Images/IconoConfirmacionFeriaVirtual.png",function(){return $("#popupLoading").modal("hide"),this.modal("hide"),!1})})};n.ReasignarEntrevista=function(){$("#popupLoading").modal("show");Utils.ConfirmBox("Reasignar entrevista","¿Está seguro que desea reasignar esta entrevista? Recuerde que solamente se reasignará, no se cambiarán las horas ni fechas dentro del sistema",function(t){if(t){n.DateInterview=n.Date;var i=Utils.decodeJWT(),u={topic:"Entrevista en vivo",Start_time:new Date(n.Date),Hour:n.Hour,IdPostulante:n.IdPostulante,IdSolicitante:i.UserId,IdPuesto:n.IdPuesto,IdEntrevista:n.IdEntrevista,IdFeriaEmpleo:n.IdFeriaEmpleo,Auto_recording:"cloud",Duration:15};f(u,ApiService.ReasignarEntrevistaFeria,function(t){if(t.Resultado){var i=t.Objeto;Utils.MessageBox("Entrevista","Entrevista","Entrevista reasignada exitosamente <br/> Entrevistador: "+i.NombreCompleto+"<br/>Correo: "+i.Email+"<br/>","Content/Images/IconoConfirmacionFeriaVirtual.png",function(){return window.location=r.baseUrl+"FeriaVirtual/DetalleFeriaVirtual?IdFeriaEmpleo="+n.IdFeriaEmpleo,!1})}else Utils.MessageBox("Entrevista","Entrevista",t.Mensaje,"Content/Images/IconoConfirmacionFeriaVirtual.png",function(){return $("#popupLoading").modal("hide"),this.modal("hide"),!1})})}else $("#popupLoading").modal("hide")})};n.ReagendarEntrevista=function(){$("#popupLoading").modal("show");Utils.ConfirmBox("Reagendar entrevista","¿Está seguro que desea reagendar esta entrevista?",function(t){if(t){n.DateInterview=n.Date;var i=Utils.decodeJWT(),u={topic:"Entrevista en vivo",Start_time:new Date(n.Date),Hour:n.Hour,IdPostulante:n.IdPostulante,IdSolicitante:i.UserId,IdPuesto:n.IdPuesto,IdEntrevista:n.IdEntrevista,IdFeriaEmpleo:n.IdFeriaEmpleo,Auto_recording:"cloud",Duration:15};f(u,ApiService.ReagendarEntrevistaFeria,function(t){t.Resultado?Utils.MessageBox("Entrevista","Entrevista","Entrevista reagendada exitosamente<br/>","Content/Images/IconoConfirmacionFeriaVirtual.png",function(){return window.location=r.baseUrl+"FeriaVirtual/DetalleFeriaVirtual?IdFeriaEmpleo="+n.IdFeriaEmpleo,!1}):Utils.MessageBox("Entrevista","Entrevista",t.Mensaje,"Content/Images/IconoConfirmacionFeriaVirtual.png",function(){return $("#popupLoading").modal("hide"),this.modal("hide"),!1})})}else $("#popupLoading").modal("hide")})};u=function(n,t,r){var u=Utils.getFilterParameters(n);i.doGet(t,u).then(r)};n.Volver=function(){window.location=r.baseUrl+"FeriaVirtual/DetalleFeriaVirtualPostulante?IdFeriaEmpleo="+n.IdFeriaEmpleo};n.Retonar=function(){window.location=r.baseUrl+"FeriaVirtual/DetalleFeriaVirtual?IdFeriaEmpleo="+n.IdFeriaEmpleo};f=function(n,t,r){var u={Objeto:n,Lista:[],Token:"",Id:0};i.doPost(t,u).then(r)};n.GenerarArrayHoras=function(n,t,i){for(var e=t.split(":"),o=i.split(":"),s=[],f="",u=+e[0],r=+e[1];f!=i;)f=(u<10?"0"+u:u)+":"+(r<10?"0"+r:r),s.push(f),r=+r+ +n,(+n>30?+r>=60:+r%60==0)&&(u=+u+1,r=+n>30?r%60:0),+o[0]==u&&+r>+o[1]&&(f=i);return s};n.SeguridadJS=function(){var n=JSON.parse(sessionStorage.getItem("role")),t;n!=null&&(t=n.where(function(n){return n.TipoAccionId==3&&n.ReferenciasAux=="EntrevistaEnVivoFeriaController"}),$.each(t,function(n,t){var i=eval("$scope."+t.ReferenciaJS);i!=undefined&&i!=null&&i!=""&&eval("$scope."+t.ReferenciaJS+"= function () { }")}))};n.dateOptions={showWeeks:!1,formatYear:"yy",minDate:new Date,startingDay:0,placement:"bottom"};n.openDatepicker=function(){n.datepicker.opened=!0};n.format="dd/MM/yyyy";n.datepicker={opened:!1}})})();