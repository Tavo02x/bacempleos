"use strict";(function(){angular.module("BacApp.controllers.VerPerfil",["jkAngularRatingStars"]).controller("VerPerfilController",function(n,t,i,r){n.obj={};n.obj.IdPostulante="";n.obj.NombreCompleto="";n.obj.Nacionalidad="";n.obj.Identificacion="";n.obj.FechaNacimiento="";n.obj.Edad="";n.obj.Genero="";n.obj.EstadoCivil="";n.obj.Telefono="";n.obj.ImagenURL="";n.obj.PaisRecidencia="";n.obj.Vehiculo="";n.obj.Email="";n.obj.Zona1="";n.obj.Zona2="";n.obj.Zona3="";n.obj.EstudiaActualidad="";n.obj.DescripcionVentajaCompetitiva="";n.obj.GradoAcademico="";n.obj.Profesion="";n.obj.PretensionSalarial="";n.obj.TrabajoBAC="";n.obj.CurriculumURL="";n.obj.Favorito=!1;n.obj.IdTipoLicencia="";n.obj.EstadoPerfil="";n.obj.TitulosCertificaciones={};n.obj.ExperienciaLaboral={};n.obj.Habilidades={};n.obj.Referencias={};n.obj.Idiomas={};n.obj.Areas={};n.obj.Paises={};n.obj.Discapacidades={};n.obj.Calificacion={};n.CambioEstado={};n.CambioEstado.IdPostulante="";n.CambioEstado.IdPuesto="";n.CambioEstado.IdEstado="";n.NombreCompartir="";n.EmailCompartir="";n.NombreInvalido=!1;n.EmailInvalido=!1;n.IdEntrevista=0;n.Zona1={};n.Zona2={};n.Zona3={};n.Idiomas={};n.Paises={};n.Pretensiones={};n.Areas={};n.Discapacidades={};n.Entrevistas={};n.Comentarios={};n.Comentario={};n.Comentario.IdComentarios=0;n.Comentario.IdUSuario="";n.Comentario.IdPostulante="";n.Comentario.Descripcion="";n.Comentario.Borrado=!1;n.StepOne=!0;n.StepTwo=!1;n.StepThree=!1;n.Rate=3;n.IsAdmin=!0;n.readOnly=!0;n.onItemRating=function(n){alert("On Rating: "+n)};n.ChangeStepOne=function(){n.StepOne=!0;n.StepTwo=!1;n.StepThree=!1;$("#StepOne").removeClass("taps").addClass("tapSelect");$("#StepTwo").removeClass("tapSelect").addClass("taps");$("#StepThree").removeClass("tapSelect").addClass("taps")};n.ChangeStepTwo=function(){n.StepOne=!1;n.StepTwo=!0;n.StepThree=!1;$("#StepOne").removeClass("tapSelect").addClass("taps");$("#StepTwo").removeClass("taps").addClass("tapSelect");$("#StepThree").removeClass("tapSelect").addClass("taps")};n.ChangeStepThree=function(){n.StepOne=!1;n.StepTwo=!1;n.StepThree=!0;$("#StepOne").removeClass("tapSelect").addClass("taps");$("#StepTwo").removeClass("tapSelect").addClass("taps");$("#StepThree").removeClass("taps").addClass("tapSelect")};n.MarcarFavorito=function(){var t={id:{value:n.obj.IdPostulante}};u(t,ApiService.PostulanteMarcarfavorito,function(){var t;n.obj.Favorito?(n.obj.Favorito=!1,t=r.baseUrl+"Content/Images/IconoNoFavorito.png",$("#imgFavorito").attr("src",t),$("#txtMarcarFavorito").html(),$("#txtMarcarFavorito").html("Marcar favorito")):(n.obj.Favorito=!0,t=r.baseUrl+"Content/Images/IconoFavorito.png",$("#imgFavorito").attr("src",t),$("#txtMarcarFavorito").html(),$("#txtMarcarFavorito").html("Desmarcar favorito"))})};n.getInfo=function(){var t=Utils.getUrlParameter("IdPostulante"),o=sessionStorage.getItem("token"),i=Utils.decodeJWT(),e={username:{value:t==""?i.unique_name:t}};u(e,ApiService.PostulanteGet,function(t){var i;n.obj.IdPostulante=t.Objeto.IdPostulante;n.obj.NombreCompleto=t.Objeto.NombreCompleto;n.obj.Nacionalidad=t.Objeto.Nacionalidad;n.obj.Identificacion=t.Objeto.Identificacion;n.obj.FechaNacimiento=t.Objeto.FechaNacimiento;n.obj.Edad=f(t.Objeto.FechaNacimiento);n.obj.Genero=t.Objeto.Genero;n.obj.EstadoCivil=t.Objeto.EstadoCivil;n.obj.Telefono=t.Objeto.Telefono;n.obj.ImagenURL=t.Objeto.ImagenURL;n.obj.PaisRecidencia=t.Objeto.PaisRecidencia;n.obj.Vehiculo=t.Objeto.Vehiculo;n.obj.Email=t.Objeto.Email;n.obj.Zona1=t.Objeto.Zona1;n.obj.Zona2=t.Objeto.Zona2;n.obj.Zona3=t.Objeto.Zona3;n.obj.EstudiaActualidad=t.Objeto.EstudiaActualidad;n.obj.GradoAcademico=t.Objeto.GradoAcademico;n.obj.Profesion=t.Objeto.Profesion;n.obj.PretensionSalarial=t.Objeto.PretensionSalarial;n.obj.TrabajoBAC=t.Objeto.TrabajoBAC;n.obj.CurriculumURL=t.Objeto.CurriculumURL;n.obj.CurriculumURL=="N/A"&&$("#bttCurriculo").text("No contiene curriculum");n.obj.TitulosCertificaciones=t.Objeto.TitulosCertificaciones;n.obj.ExperienciaLaboral=t.Objeto.ExperienciaLaboral;n.obj.Habilidades=t.Objeto.Habilidades;n.obj.Referencias=t.Objeto.Referencias;n.obj.Idiomas=t.Objeto.Idiomas;n.obj.Areas=t.Objeto.Areas;n.obj.Paises=t.Objeto.Paises;n.obj.Discapacidades=t.Objeto.Discapacidades;n.obj.Favorito=t.Objeto.Favorito;n.obj.DescripcionVentajaCompetitiva=t.Objeto.DescripcionVentajaCompetitiva;n.obj.IdTipoLicencia=t.Objeto.IdTipoLicencia;n.obj.EstadoPerfil=t.Objeto.EstadoPostulante;n.obj.AplicacionesPuesto=t.Objeto.AplicacionesPuesto;n.Comentarios=t.Objeto.Comentarios;n.obj.Favorito?(i=r.baseUrl+"Content/Images/IconoFavorito.png",$("#imgFavorito").attr("src",i),$("#txtMarcarFavorito").html("Desmarcar favorito")):(i=r.baseUrl+"Content/Images/IconoNoFavorito.png",$("#imgFavorito").attr("src",i),$("#txtMarcarFavorito").html("Marcar favorito"));$("#FotoPerfil").attr("src",n.obj.ImagenURL);$.each(t.Objeto.AplicacionesPuesto,function(i,r){var u="";u+='<div class="col-lg-8 Division">'+r.Descripcion;u+='   <input id="hiddenPuesto'+i+'" value="'+r.IdPuesto+'" type="hidden" />';u+='   <input id="hiddenPostulante'+i+'" value="'+r.IdPostulante+'" type="hidden" />';u+="<\/div>";u+='<div class="col-lg-4">';u+='   <select id="SelEstado'+i+'" data-id="'+i+'">';$.each(t.Objeto.EstadosPerfil,function(n,t){var i=t.IdEstadoPerfil==r.IdEstadoPerfil?"selected":"";u+='       <option value="'+t.IdEstadoPerfil+'" '+i+" >"+t.EstadoPerfil1+"<\/option>"});u+="   <\/select>";u+="<\/div>";u+='<div class="SubrayadoDivTotal saltoSeccion saltoSeccionBajo-4"><\/div>';$("#Aplicaciones").append(u);$("#SelEstado"+i).on("change",function(){$("#popupLoading").modal("show");n.CambioEstado.IdPostulante=$("#hiddenPostulante"+i).val();n.CambioEstado.IdPuesto=$("#hiddenPuesto"+i).val();n.CambioEstado.IdEstado=+$("#SelEstado"+i).val();switch(n.CambioEstado.IdEstado){case 1:n.CambiarEstadoPerfil();break;case 2:n.CambiarEstadoPerfil();break;case 3:Utils.ConfirmBox("Cambio estado de aplicante","¿Está seguro que desea a archivar a este aplicante?<br /> Notesé que el mismo se desactivara en el sistema.",function(t){t?n.CambiarEstadoPerfil():$("#popupLoading").modal("hide")});break;case 4:Utils.ConfirmBox("Cambio estado de aplicante","¿Está seguro que desea pre-seleccionar a este aplicante?",function(t){t?n.CambiarEstadoPerfil():$("#popupLoading").modal("hide")});break;case 5:Utils.ConfirmBox("Cambio estado de aplicante","¿Está seguro que desea contratar a este aplicante?",function(t){t?n.CambiarEstadoPerfil():$("#popupLoading").modal("hide")})}})});n.LoadEntrevistasAplicadas(n.obj.IdPostulante)})};n.CambiarEstadoPerfil=function(){var t=Utils.decodeJWT(),i={IdPostulante:{value:n.CambioEstado.IdPostulante},IdPuesto:{value:n.CambioEstado.IdPuesto},IdEstado:{value:n.CambioEstado.IdEstado},IdUsuario:{value:t.UserId}};u(i,ApiService.CambiarEstadoPerfil,function(t){t.Resultado?Utils.MessageBox("Cambio estado aplicación","Cambio estado aplicación",t.Mensaje,"Content/Images/IconoConfimacion1.png",function(){switch(n.CambioEstado.IdEstado){case 3:window.location=r.baseUrl+"Postulante/VerPostulantes";break;default:location.reload();this.modal("hide")}}):Utils.MessageBox("Cambio estado aplicación","Cambio estado aplicación",t.Mensaje,"Content/Images/IconoErrorGeneral.png",function(){this.modal("hide");$("#popupLoading").modal("hide")})})};n.DescargarPerfil=function(){var n=Utils.getUrlParameter("IdPostulante");window.open(r.baseUrl+"Postulante/PerfilDescargar?email="+n,"_blank")};var f=function(n){var t=new Date,i=new Date(n),r=t.getFullYear()-i.getFullYear(),u=t.getMonth()-i.getMonth();return(u<0||u===0&&t.getDate()<i.getDate())&&r--,r},u=function(n,t,r){var u=Utils.getFilterParameters(n);i.doGet(t,u).then(r)},e=function(n,t,r){var u={Objeto:n,Lista:[],Token:"",Id:0};i.doPost(t,u).then(r)};n.EditarPerfil=function(){window.location=r.baseUrl+"postulante/miperfil?idPostulante="+n.obj.IdPostulante};n.EntrevistaPregabada=function(){window.location=r.baseUrl+"Entrevistas/SolicitarEntrevistas"};n.EnVivo=function(){window.location=r.baseUrl+"Entrevistas/SolicitarEntrevistas?IdPostulante="+n.obj.IdPostulante+"&User="+n.obj.Email};n.Pregrabada=function(){window.location=r.baseUrl+"Preguntas/MantenimientoPreguntas?IdPostulante="+n.obj.IdPostulante+"&User="+n.obj.Email};n.AplicarSeguridadHTML=function(){Utils.SeguridadHTML()};n.Qualification=function(n,t){Utils.Qualification(n,t)};n.LoadEntrevistasAplicadas=function(t){var i={userId:{value:t}};u(i,ApiService.GetEntrevistas,function(t){n.Entrevistas=t;var i=JSON.parse(sessionStorage.getItem("role")),r=i.where(function(n){return n.AccionId==78});r.length==0&&(n.IsAdmin=!1)})};n.AceptarEntrevista=function(t){$("#popupLoading").modal("show");var i={IdEntrevista:{value:t}};Utils.ConfirmBox("Aceptar entrevista","¿Desea aceptar esta entrevista?",function(t){t?($("#popupLoading").modal("show"),u(i,ApiService.AceptarEntrevista,function(){Utils.MessageBox("Aceptar entrevista","Aceptar entrevista","Entrevista aceptada exitosamente","Content/Images/IconoConfimacion1.png",function(){this.modal("hide");$("#popupLoading").modal("hide");n.LoadEntrevistasAplicadas(n.obj.IdPostulante)})})):($("#popupLoading").modal("show"),u(i,ApiService.RechazarEntrevista,function(){Utils.MessageBox("Rechazar entrevista","Rechazar entrevista","Entrevista rechazada exitosamente","Content/Images/IconoConfimacion1.png",function(){this.modal("hide");$("#popupLoading").modal("hide");n.LoadEntrevistasAplicadas(n.obj.IdPostulante)})}))})};n.OpenModal=function(t){$("#popupArea").modal("show");n.IdEntrevista=t;n.NombreCompartir="";n.EmailCompartir="";n.NombreInvalido=!1;n.EmailInvalido=!1};n.CompartirPerfil=function(){if(n.NombreInvalido=n.NombreCompartir==""?!0:!1,n.EmailInvalido=n.EmailCompartir==""?!0:!1,n.NombreInvalido==!1&&n.EmailInvalido==!1){var t={IdEntrevista:{value:n.IdEntrevista},Email:{value:n.EmailCompartir},Nombre:{value:n.NombreCompartir},IdPostulante:{value:n.obj.IdPostulante}};$("#popupLoading").modal("show");u(t,ApiService.CompartirPerfil,function(t){t.Resultado?Utils.MessageBox("Compartir Entrevista","Compartir Entrevista","La entrevista ha sido compartida exitosamente","Content/Images/IconoConfimacion1.png",function(){this.modal("hide");$("#popupLoading").modal("hide")}):Utils.MessageBox("Compartir Entrevista","Compartir Entrevista",t.Mensaje,"Content/Images/IconoErrorGeneral.png",function(){this.modal("hide");$("#popupLoading").modal("hide")});n.NombreCompartir="";n.EmailCompartir="";n.NombreInvalido=!1;n.EmailInvalido=!1})}};n.LimpiarComentarios=function(){n.Comentario.IdComentarios=0;n.Comentario.IdUsuario="";n.Comentario.IdPostulante="";n.Comentario.Descripcion="";n.Comentario.Borrado=!1};n.ReturnComment=function(){n.$apply(function(){n.LimpiarComentarios();n.getInfo()})};n.Guardar=function(){var i=Utils.decodeJWT(),t;n.Comentario.IdUsuario=i.UserId;n.Comentario.IdPostulacion=n.obj.IdPostulante;t=!0;n.Comentario.Descripcion==""?t=!1:n.show500=!1;t?e(n.Comentario,ApiService.ComentarioSave,function(n){n.Resultado?Utils.MessageBox("Comentarios","Comentarios",n.Mensaje,"Content/Images/IconoConfimacion1.png",function(){location.reload();this.modal("hide")}):Utils.MessageBox("Comentarios","Comentarios",n.Mensaje,"Content/Images/IconoErrorGeneral.png",function(){this.modal("hide");$("#popupLoading").modal("hide")})}):n.show500=!0};n.SeguridadJS=function(){var n=JSON.parse(sessionStorage.getItem("role")),t;n!=null&&(t=n.where(function(n){return n.TipoAccionId==3&&n.ReferenciasAux=="VerPerfilController"}),$.each(t,function(n,t){var i=eval("$scope."+t.ReferenciaJS);i!=undefined&&i!=null&&i!=""&&eval("$scope."+t.ReferenciaJS+"= function () { }")}))};n.ReturnLobby=function(){window.location=r.baseUrl+"Postulante/VerPostulantes"}})})();