"use strict";(function(){angular.module("BacApp.controllers.puestosEdit",[]).controller("puestosEditController",function(n,t,i,r){n.model={};n.model.IdPuesto=0;n.model.Titulo="";n.model.Descripcion="";n.model.ImagenURL="";n.model.IdArea="";n.model.IdNivelAcademico=0;n.model.FechaCierreOferta="";n.model.IdJornada="";n.model.Publicado=!0;n.model.Activo=!0;n.model.IdIdioma=0;n.model.IdPais=0;n.model.IdZona1=0;n.idiomaLabel="";n.areaLabel="";n.paisLabel="";n.Idiomas={};n.Paises={};n.JornadaLaboral={};n.GradoAcademico={};n.Areas={};n.show1=!1;n.show2=!1;n.show3=!1;n.show4=!1;n.show5=!1;n.show6=!1;n.show7=!1;n.show8=!1;n.StepOne=!0;n.StepTwo=!1;n.StepThree=!1;n.StepFour=!1;n.getZona=function(){var t={id:{value:n.model.IdPais}};u(t,ApiService.Zona1Get,function(t){n.Zona1=t.Lista})};n.getGradoAcademico=function(){u({},ApiService.GradoAcademicoGet,function(t){n.GradoAcademico=t.Lista})};n.getPaises=function(){var t=Utils.decodeJWT(),i={id:{value:t.UserId}};u(i,ApiService.GetPais,function(t){n.Paises=t.Lista})};n.getIdiomas=function(){u({},ApiService.getIdioma,function(t){n.Idiomas=t.Lista})};n.getJornadaLaboral=function(){u({},ApiService.JornadaLaboralGet,function(t){n.JornadaLaboral=t.Lista})};n.AreaLaboralGet=function(){u({},ApiService.AreaLaboralGet,function(t){n.Areas=t.Lista})};n.GetLabelFromGrado=function(n,t){var i,r;if(t)for(i=0;i<t.length;i++)if(r=t[i].IdNivelAcademico,r===n)return t[i].Descripcion};n.GetLabelFromJornada=function(n,t){var i,r;if(t)for(i=0;i<t.length;i++)if(r=t[i].IdJornada,r===n)return t[i].Descripcion};n.GetDate=function(n){var t=new Date(n);return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()};n.SavePuesto=function(){for(var i,h,c,u=n.GetValues("NivelIdioma",["IdIdioma","Porcentaje"]),l=n.GetValuesRequisitos("Puestorequisito",["Descripcion"]),e=[],o=[],s=[],t=0;t<u.length;t++)i={IdPuesto:0,IdIdioma:u[t].IdIdioma,Porcentaje:u[t].Porcentaje,Borrado:!1},e.push(i);i={IdPuesto:0,IdPais:n.model.IdPais,Borrado:!1};o.push(i);s.push({IdPuesto:0,IdJornada:n.model.IdJornada,Borrado:!1});h=Utils.getValCheckEdit("areas","IdArea");n.model.IdArea=h[0].IdArea;c={PuestoInfo:{IdPuesto:n.model.IdPuesto,Titulo:n.model.Titulo,Descripcion:n.model.Descripcion,ImagenURL:"",IdArea:n.model.IdArea,IdNivelAcademico:n.model.IdNivelAcademico,FechaCierreOferta:n.model.FechaCierreOferta,Publicado:n.model.Publicado,Activo:n.model.Activo,IdZona1:n.model.IdZona1},Idiomas:e,TipoJornadas:s,Puestos_Paises_BAC:o,Postulantes:[],Ferias:[],Requisitos:l};f(c,ApiService.PuestosSave,function(n){n.Resultado?Utils.MessageBox("Puesto actualizado correctamente","Puesto actualizado correctamente","La información del puesto ha sido actualizada en nuestra base de datos.","Content/Images/IconoConfimacion1.png",function(){window.location=r.baseUrl+"Puesto/FiltrarPuestos";this.modal("hide");$("#popupLoading").modal("hide")}):Utils.MessageBox("Actualización puesto","Actualización puesto",n.Mensaje,"Content/Images/IconoErrorGeneral.png",function(){$("#popupLoading").modal("hide");this.modal("hide")})})};var u=function(n,t,r){var u=Utils.getFilterParameters(n);i.doGet(t,u).then(r)},f=function(n,t,r){var u={Objeto:n,Lista:[],Token:"",Id:n.PuestoInfo.IdPuesto};i.doPost(t,u).then(r)};n.getPuesto=function(){var t=Utils.getUrlParameter("IdPuesto"),i={id:{value:t}};u(i,ApiService.PuestosGet,function(t){if(t.Resultado){n.dataCargada=t.Objeto;n.model.IdPuesto=n.dataCargada.PuestoInfo.IdPuesto;n.model.Titulo=n.dataCargada.PuestoInfo.Titulo;n.model.Descripcion=n.dataCargada.PuestoInfo.Descripcion;n.model.ImagenURL="";n.model.IdArea=n.dataCargada.PuestoInfo.IdArea;n.model.IdNivelAcademico=n.dataCargada.PuestoInfo.IdNivelAcademico;var i=new Date(n.dataCargada.PuestoInfo.FechaCierreOferta);n.model.FechaCierreOferta=i;n.model.IdJornada=n.dataCargada.TipoJornadas[0].IdJornada;n.model.Publicado=n.dataCargada.PuestoInfo.Publicado;n.model.Activo=n.dataCargada.PuestoInfo.Activo;n.CargarReapeter(n.dataCargada.Idiomas);n.CargarReapeterRequisitos(n.dataCargada.Requisitos);$("input[name=areas]").each(function(){var i=$(this).val(),t=!1;i==n.dataCargada.PuestoInfo.IdArea&&(t=!0);$(this).prop("checked",t);$(this).prop("value",t)});n.model.IdPais=n.dataCargada.Puestos_Paises_BAC[0].IdPais;n.getZona();n.model.IdZona1=n.dataCargada.PuestoInfo.IdZona1}else Utils.MessageBox("Mantenimiento Puesto","Puesto",t.Mensaje,"Content/Images/IconoErrorGeneral.png",function(){$("#popupLoading").modal("hide");this.modal("hide")})})};n.contador=0;n.AgregarIdioma=function(){var t=n.GetValues("NivelIdioma",["IdIdioma","Porcentaje"]);n.chkDuplicates(t,!0)?n.RepeticionIdioma=!0:(n.AgregarNodo("NivelIdioma",n.contador),n.RepeticionIdioma=!1)};n.CargarReapeter=function(t){$.each(t,function(t,i){n.AgregarNodoWithValue("NivelIdioma",t,i)})};n.AgregarNodoWithValue=function(t,i,r){n.AgregarNodo(t,i);$("#txtIdioma"+i).val(r.IdIdioma).change();$("#selNivel"+i).val(r.Porcentaje).change()};n.AgregarNodo=function(t,i){var u='<div id="pnlRepeatNivelIdioma'+i+'">';u+='       <div  class="row">';u+='           <div id="div_'+i+'" class="col-sm-10 col-10 pnlRepeatNivelIdioma'+i+'">';u+='               <select id="txtIdioma'+i+'">';u+='                   <option disabled selected value="">Idioma<\/option>';$.each(n.Idiomas,function(n,t){u+='               <option value="'+t.IdIdioma+'" ng-value="'+t.IdIdioma+'">'+t.Descripcion+"<\/option>"});u+="               <\/select>";u+='               <select id="selNivel'+i+'">';u+='                   <option disabled selected value="">Nivel<\/option>';u+='                   <option value="0">Bajo<\/option>';u+='                   <option value="50">Intermedio<\/option>';u+='                   <option value="100">Alto<\/option>';u+="               <\/select>";u+="           <\/div>";u+='           <div class="col-sm-2 col-2"> ';u+='               <img id="borrador'+i+'" src = "'+r.baseUrl+'Content/Images/Basurero.png" class="imgLetraContenido punteroSelector" /> ';u+="           <\/div>";u+="       <\/div>";u+=" <\/div> ";$("#"+t).append(u);$("#borrador"+i).on("click",function(){$("#pnlRepeatNivelIdioma"+i).remove()});n.contador=n.contador+1};n.RemoveElement=function(n){$("#"+n).remove()};n.GetValues=function(n,t){var r=$("#"+n+" > div").map(function(){return this.id}).toArray(),i="[";return r.forEach(function(n){var u="#"+n+" ."+n,f=$(u).each(function(){return this.childNodes}).toArray(),r;i+="{";r=0;f[0].childNodes.forEach(function(n){n.tagName!=undefined&&n.value!=""&&n.value!=undefined&&(i+=t[r]+":'"+n.value+"',",r=t.length-1==r?0:r+1)});i=i.substring(0,i.length-1)+"},"}),i=i.substring(0,i.length-1)+"]",eval(i)};n.contadorRequisitos=0;n.AgregarRequisitos=function(){var t=n.GetValuesRequisitos("Puestorequisito",["Descripcion"]);n.chkDuplicates(t,!0)?n.RepeticionRequisitos=!0:(n.AgregarNodoRequisitos("Puestorequisito",n.contadorRequisitos),n.RepeticionRequisitos=!1)};n.CargarReapeterRequisitos=function(t){$.each(t,function(t,i){n.AgregarNodoRequisitosWithValue("Puestorequisito",t,i)})};n.AgregarNodoRequisitosWithValue=function(t,i,r){n.AgregarNodoRequisitos(t,i);$("#txtRequisito"+i).val(r.Descripcion)};n.AgregarNodoRequisitos=function(t,i){var u='<div id="pnlRepeatRequisitos'+i+'">';u+='       <div  class="row">';u+='           <div id="divR_'+i+'" class="col-sm-10 col-10 pnlRepeatRequisitos'+i+'">';u+='               <input id="txtRequisito'+i+'" type="text" placeholder="Requisito" class="LetrasContenido" />';u+="           <\/div>";u+='           <div class="col-sm-2 col-2"> ';u+='               <img id="borradorR'+i+'" src = "'+r.baseUrl+'Content/Images/Basurero.png" class="imgLetraContenido punteroSelector" /> ';u+="           <\/div>";u+="       <\/div>";u+=" <\/div> ";$("#"+t).append(u);$("#borradorR"+i).on("click",function(){$("#pnlRepeatRequisitos"+i).remove()});n.contadorRequisitos=n.contadorRequisitos+1};n.RemoveElementRequisitos=function(n){$("#"+n).remove()};n.GetValuesRequisitos=function(n,t){var r=$("#"+n+" > div").map(function(){return this.id}).toArray(),i="[";return r.forEach(function(n){var r="#"+n+" ."+n,u=$(r).each(function(){return this.childNodes}).toArray();i+="{";u[0].childNodes.forEach(function(n){n.tagName!=undefined&&n.value!=""&&n.value!=undefined&&n.value!=0&&(i+=t[0]+":'"+n.value+"'")});i+="},"}),i=i.substring(0,i.length-1)+"]",eval(i)};n.ValidateStepOne=function(){var t=!0,i,r;return n.model.Titulo==""&&(n.show1=!0,t=!1),n.model.Descripcion==""&&(n.show2=!0,t=!1),(n.model.IdNivelAcademico==""||n.model.IdNivelAcademico==null)&&(n.show3=!0,t=!1),(n.model.IdJornada==""||n.model.IdJornada==null)&&(n.show4=!0,t=!1),n.model.FechaCierreOferta==""&&(n.show5=!0,t=!1),i=n.GetValues("NivelIdioma",["IdIdioma","Porcentaje"]),n.chkDuplicates(i,!0)?(n.RepeticionIdioma=!0,t=!1):(i.length<=0&&(n.show6=!0,t=!1),n.RepeticionIdioma=!1),r=n.GetValuesRequisitos("Puestorequisito",["Descripcion"]),n.chkDuplicates(r,!0)?(n.RepeticionRequisitos=!0,t=!1):(r.length<=0&&(n.show61=!0,t=!1),n.RepeticionRequisitos=!1),t&&n.LimpiarShowStep1(),t};n.LimpiarShowStep1=function(){n.show1=!1;n.show2=!1;n.show3=!1;n.show4=!1;n.show5=!1;n.show6=!1;n.show61=!1};n.ValidateStepTwo=function(){var t=!0,i=Utils.getValCheckEdit("areas","IdArea");return i.length<=0&&(n.show7=!0,t=!1),t&&(n.show7=!1),t};n.ValidateStepThree=function(){var t=!0,i=Utils.getValCheckEdit("pais","IdPais");return i.length<=0&&(n.show8=!0,t=!1),t&&(n.show8=!1),t};n.ChangeStep=function(){var i=n.ValidateStepOne(),f,r,u,t;if(n.StepOne==!0&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!1&&i)n.StepOne=!1,n.StepTwo=!0,n.StepThree=!1,n.StepFour=!1,$("#divStepTwo").removeClass("Secundario").addClass("Primaria"),$("#circuloStepTwo").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepTwo").removeClass("textoSecundario").addClass("textoPrimario"),i=n.ValidateStepTwo();else if(n.StepOne==!1&&n.StepTwo==!0&&n.StepThree==!1&&n.StepFour==!1&&i)n.StepOne=!1,n.StepTwo=!1,n.StepThree=!0,n.StepFour=!1,$("#divStepThree").removeClass("Secundario").addClass("Primaria"),$("#circuloStepThree").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepThree").removeClass("textoSecundario").addClass("textoPrimario"),i=n.ValidateStepThree();else if(n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!0&&n.StepFour==!1&&i){for(n.StepOne=!1,n.StepTwo=!1,n.StepThree=!1,n.StepFour=!0,$("#divStepFour").removeClass("Secundario").addClass("Primaria"),$("#circuloStepFour").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepFour").removeClass("textoSecundario").addClass("textoPrimario"),f=Utils.getValCheckEdit("areas","IdArea"),n.model.IdArea=f[0].IdArea,n.areaLabel=n.Areas.where(function(t){return t.IdArea==n.model.IdArea}).select(function(n){return n.Area}),r=n.GetValues("NivelIdioma",["IdIdioma","Porcentaje"]),t=0;t<r.length;t++)n.idiomaLabel+=n.Idiomas.where(function(n){return n.IdIdioma==r[t].IdIdioma}).select(function(n){return n.Descripcion})+",";for(u=Utils.getValCheckEdit("pais","IdPais"),t=0;t<u.length;t++)n.paisLabel+=n.Paises.where(function(n){return n.IdPais==u[t].IdPais}).select(function(n){return n.Descripcion})+",";$("#btnContinuar").val("Guardar")}else n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!0&&n.SavePuesto();$("html, body").animate({scrollTop:0},600)};n.ReturnStep=function(){$("#btnContinuar").val("Siguiente");n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!0?(n.StepOne=!1,n.StepTwo=!1,n.StepThree=!0,n.StepFour=!1,$("#divStepFour").removeClass("Primaria").addClass("Secundario"),$("#divStepThree").removeClass("Secundario").addClass("Primaria"),$("#circuloStepFour").removeClass("CirculoPrimario").addClass("CirculoSecundario"),$("#circuloStepThree").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepFour").removeClass("textoPrimario").addClass("textoSecundario"),$("#textStepThree").removeClass("textoSecundario").addClass("textoPrimario")):n.StepOne==!1&&n.StepTwo==!1&&n.StepThree==!0&&n.StepFour==!1?(n.StepOne=!1,n.StepTwo=!0,n.StepThree=!1,n.StepFour=!1,$("#divStepThree").removeClass("Primaria").addClass("Secundario"),$("#divStepTwo").removeClass("Secundario").addClass("Primaria"),$("#circuloStepThree").removeClass("CirculoPrimario").addClass("CirculoSecundario"),$("#circuloStepTwo").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepThree").removeClass("textoPrimario").addClass("textoSecundario"),$("#textStepTwo").removeClass("textoSecundario").addClass("textoPrimario")):n.StepOne==!1&&n.StepTwo==!0&&n.StepThree==!1&&n.StepFour==!1?(n.StepOne=!0,n.StepTwo=!1,n.StepThree=!1,n.StepFour=!1,$("#divStepTwo").removeClass("Primaria").addClass("Secundario"),$("#divStepOne").removeClass("Secundario").addClass("Primaria"),$("#circuloStepTwo").removeClass("CirculoPrimario").addClass("CirculoSecundario"),$("#circuloStepOne").removeClass("CirculoSecundario").addClass("CirculoPrimario"),$("#textStepTwo").removeClass("textoPrimario").addClass("textoSecundario"),$("#textStepOne").removeClass("textoSecundario").addClass("textoPrimario")):n.StepOne==!0&&n.StepTwo==!1&&n.StepThree==!1&&n.StepFour==!1&&(window.location=r.baseUrl+"Puesto/FiltrarPuestos");$("html, body").animate({scrollTop:0},600)};n.Volver=function(){window.location=r.baseUrl+"Puesto/VerPuesto?IdPuesto="+n.model.IdPuesto};n.SeguridadJS=function(){var n=JSON.parse(sessionStorage.getItem("role")),t;n!=null&&(t=n.where(function(n){return n.TipoAccionId==3&&n.ReferenciasAux=="puestosEditController"}),$.each(t,function(n,t){var i=eval("$scope."+t.ReferenciaJS);i!=undefined&&i!=null&&i!=""&&eval("$scope."+t.ReferenciaJS+"= function () { }")}))};n.chkDuplicates=function(n,t){var u=n.length,f={},e=n.slice(),r=[],i;for(e.sort();u--;){if(i=e[u],/nul|nan|infini/i.test(String(i))&&(i=String(i)),f[JSON.stringify(i)]){if(t)return!0;r.push(i)}f[JSON.stringify(i)]=!0}return t?!1:r.length?r:null};n.dateOptions={showWeeks:!1,formatYear:"yy",minDate:new Date,startingDay:0,placement:"bottom"};n.openDatepicker=function(){n.datepicker.opened=!0};n.format="dd/MM/yyyy";n.datepicker={opened:!1}})})();